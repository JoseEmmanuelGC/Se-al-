<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Gráfica de señal</title>
  </head>
  <body>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <div id="chart_div"></div>
  </body>

  <script>
    google.charts.load('current', {packages: ['corechart', 'line']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
      const POINTS_PER_SECOND = 60
      const POINTS_PER_UNIT = 10
      const START_TIME = 0
      const WIDTH = 20

      // Gaussian Noise Generator <<<
      function valueFromGaussianDistribution(min, max) {
        result = 0
        do {
          value1 = 0
          value2 = 0
          rand  = 0

          do {
              value1 = (2 * Math.random()) - 1
              value2 = (2 * Math.random()) - 1
              rand  = (value1 * value1) + (value2 * value2)
          } while (rand >= 1)

          rand = Math.sqrt((-2 * Math.log(rand)) / rand)

          result = value1 * rand
        } while (result > max || result < min)
        return result
      }
      // >>> Gaussian Noise Generator

      // Functions<<<
      function func(x) {
        return Math.sin(x);
      }
      
      function noiseSNR5(x) {
        return (Math.sin(x) / 5)
      }
      
      function gaussianNoiseSNR10() {
        return valueFromGaussianDistribution(-1, 1) / 10
      }

      function firstData() {
        start = START_TIME * POINTS_PER_UNIT
        limit = start + (WIDTH * POINTS_PER_UNIT)
        array = [];
        for (var i = start; i < limit; i++) {
          timeFixed = i / POINTS_PER_UNIT
          values = [timeFixed,
            func(timeFixed),
            func(timeFixed) + noiseSNR5(timeFixed),
            func(timeFixed) + gaussianNoiseSNR10()];
          array.push(values);
        }
        return array;
      }

      function addData() {
        time += 1;
        timeFixed = time / POINTS_PER_UNIT
        data.removeRow(0);
        data.addRow([timeFixed,
          func(timeFixed),
          func(timeFixed) + noiseSNR5(timeFixed),
          func(timeFixed) + gaussianNoiseSNR10()]);
        chart.draw(data, options)
      }
      // >>>Functions

      let time = (START_TIME + WIDTH) * POINTS_PER_UNIT;

      var data = new google.visualization.DataTable();
      data.addColumn('number', '');
      data.addColumn('number', 'sen(x)');
      data.addColumn('number', 'sen(x) + (sin(x)/5)');
      data.addColumn('number', 'sen(x) + GaussianNoise/10');

      data.addRows(firstData());

      var options = {
        hAxis: {
          title: 'x',
        },
        colors: ['#a52714', '#097138', '#5427a4'],
        curveType: 'function',
      };

      var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
      chart.draw(data, options);

      setInterval(addData, 1000 / POINTS_PER_SECOND)
    }
  </script>
</html>
